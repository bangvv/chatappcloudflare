<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>T√¨m B·∫°n Quanh ƒê√¢y</title>
  <meta name="description" content="Chat App l√† ·ª©ng d·ª•ng web gi√∫p b·∫°n k·∫øt n·ªëi v√† tr√≤ chuy·ªán ng·∫´u nhi√™n v·ªõi ng∆∞·ªùi l·∫° ho√†n to√†n mi·ªÖn ph√≠, kh√¥ng c·∫ßn ƒëƒÉng k√Ω.">

  <!-- Th·∫ª t·ª´ kh√≥a (Google kh√¥ng c√≤n qu√° coi tr·ªçng, nh∆∞ng n√™n c√≥) -->
  <meta name="keywords" content="chat, tr√≤ chuy·ªán, chat ng·∫´u nhi√™n, chat v·ªõi ng∆∞·ªùi l·∫°, chat ·∫©n danh, ·ª©ng d·ª•ng chat mi·ªÖn ph√≠">

  <!-- T√°c gi·∫£ -->
  <meta name="author" content="hngame.store">

  <!-- Open Graph (d√†nh cho chia s·∫ª Facebook, Zalo...) -->
  <meta property="og:title" content="Tr√≤ chuy·ªán ·∫©n danh v·ªõi ng∆∞·ªùi l·∫° ng·∫´u nhi√™n" />
  <meta property="og:description" content="Tr·∫£i nghi·ªám tr√≤ chuy·ªán mi·ªÖn ph√≠, k·∫øt n·ªëi b·∫°n v·ªõi ng∆∞·ªùi l·∫° ngay l·∫≠p t·ª©c." />
  <meta property="og:image" content="https://hngame.store/image/chattimban.png" /> <!-- s·ª≠a th√†nh link ·∫£nh c·ªßa b·∫°n -->
  <meta property="og:url" content="chattimbanquanhday.hngame.store" />
  <meta property="og:type" content="website" />

  <!-- Favicon (icon nh·ªè ·ªü tab tr√¨nh duy·ªát) -->
  <link rel="icon" href="https://hngame.store/image/chattimban.png" />
  <style>
		 body, html {
			height: 100%;
			margin: 0;
		  }

		  body {
			display: flex;
			justify-content: center; /* cƒÉn ngang gi·ªØa */
			align-items: center;     /* cƒÉn d·ªçc gi·ªØa */
			background: #f5f5f5;
		  }

		  #formSection {
			background: white;
			padding: 20px 30px;
			border-radius: 12px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
			display: flex;
			flex-wrap: wrap;
			gap: 12px 20px;
			max-width: 400px;
			justify-content: center;
		  }

		  #formSection label {
			flex: 1 1 100%; /* m·ªói label chi·∫øm m·ªôt d√≤ng */
			font-weight: 600;
			font-size: 16px;
		  }

		  #formSection input,
		  #formSection select {
			width: 100%;
			padding: 8px 10px;
			margin-top: 6px;
			font-size: 16px;
			border: 1px solid #ccc;
			border-radius: 8px;
			box-sizing: border-box;
		  }

		  #connectBtn {
			flex: 1 1 100%;
			margin-top: 10px;
			padding: 12px;
			font-size: 18px;
			background-color: #007bff;
			color: white;
			border: none;
			border-radius: 10px;
			cursor: pointer;
		  }

		  #connectBtn:hover {
			background-color: #0056b3;
		  }

	#chatWrapper {
		display: none;
		justify-content: center; /* cƒÉn ngang gi·ªØa */
		align-items: center;     /* cƒÉn d·ªçc gi·ªØa */
		width: 100%;
		height: 100%;
		max-width: 1200px;

	}

  #chatBox {
    width: 100%;
	height: 100%;
    max-width: 100%;
    background: white;
    border-radius: 12px;
    padding: 5px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    gap: 10px;
    box-sizing: border-box;
  }

  #topBar {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #status {
    font-size: 14px;
    color: #333;
  }
  
.menu-wrapper {
  position: relative;
  display: inline-block;
}

#menuBtn {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
}

.menu-dropdown {
  display: none;
  position: absolute;
  right: 0;
  background-color: white;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  border-radius: 8px;
  overflow: hidden;
  z-index: 10;
  min-width: 120px;
}

.menu-item {
  padding: 10px 14px;
  cursor: pointer;
  font-size: 14px;
  border-bottom: 1px solid #eee;
}

.menu-item:last-child {
  border-bottom: none;
}

.menu-item:hover {
  background-color: #f2f2f2;
}

  

  #messages {
	flex: 1;
	overflow-y: auto;
	padding: 10px;
	border: 1px solid #ddd;
	border-radius: 8px;
	background: #f9f9f9;
	font-size: 14px;
	scroll-behavior: smooth;
  }
	#messages .me {
		color: #003333;
		align-self: flex-end;
		margin-left: auto;
		text-align: right;
	}

	#messages .partner {
		color: black;
		align-self: flex-start;
		margin-right: auto;
		text-align: left;
	}

	#inputArea {
	  bottom: 0;
	  left: 0;
	  right: 0;
	  width: 100%;
	  display: flex;
	  gap: 10px;
	  padding: 10px 0px 0px 0px;
	  background-color: white;
	  border-top: 1px solid #ccc;
	  box-sizing: border-box;
	  /* b·ªè margin-top n·∫øu c√≥ */
	  margin-top: 0;
	}


	#msgInput {
	  flex: 1;
	  padding: 8px;
	  font-size: 16px;
	}

	#sendBtn {
	  padding: 8px 16px;
	  font-size: 16px;
	  background-color: #007bff;
	  color: white;
	  border: none;
	  border-radius: 4px;
	  cursor: pointer;
	}

  @media (min-width: 768px) {
	#chatBox {
	  max-width: 50%;
	}
  }
  
/*----------------------------------------*/
  /* Banner d√πng chung */
  .google-like-ad {
    position: fixed;
    left: 10px;
    right: 10px;
    height: 80px;
    background: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    border-radius: 8px;
    display: flex;
    align-items: center;
    padding: 10px;
    font-family: sans-serif;
    z-index: 9999;
    animation: fadeIn 0.5s;
  }
  .google-like-ad-top { top: 10px; }
  .google-like-ad-bottom { bottom: 10px; }
  .ad-img {
    width: 90px;
    height: 90px;
    border-radius: 6px;
    object-fit: cover;
    margin-right: 10px;
  }
  .ad-content {
    flex: 1;
  }
  .ad-title {
    font-size: 14px;
    font-weight: bold;
    margin-bottom: 4px;
    color: #000;
  }
  .ad-desc {
    font-size: 12px;
    color: #555;
  }
  .ad-action {
    background: #4285F4;
    color: white;
    padding: 6px 12px;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    text-decoration: none;
    white-space: nowrap;
  }
  .ad-close {
    position: absolute;
    top: 5px;
    right: 8px;
    font-size: 16px;
    color: #888;
    cursor: pointer;
  }
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(20px);}
    to {opacity: 1; transform: translateY(0);}
  }

  </style>
</head>
<body>
<div id="formSection">
	<h1>T√¨m b·∫°n chat</h1>
  <label>T√™n: <input id="name"/></label>
  <label>Tu·ªïi: <input id="age" type="number"/></label>
  <label>Gi·ªõi t√≠nh: 
    <select id="gender">
      <option value="">Ch·ªçn</option>
      <option value="male">Nam</option>
      <option value="female">N·ªØ</option>
    </select>
  </label>
  <label>V·ªã tr√≠: 
    <select id="vitri">
      <option value="">Ch·ªçn</option>
      <option value="mienbac">B·∫Øc</option>
      <option value="mientrung">Trung</option>
	  <option value="miennam">Nam</option>
    </select>
  </label>
  <label>Mu·ªën t√¨m: 
    <select id="lookingFor">
      <option value="">Ch·ªçn</option>
      <option value="male">Nam</option>
      <option value="female">N·ªØ</option>
    </select>
  </label>
  <button id="connectBtn">K·∫øt n·ªëi</button>
  <div id="statusConnect"></div>
</div>

<div id="chatWrapper">
  <div id="chatBox">
    <div id="topBar">
      <div id="status">ƒêang k·∫øt n·ªëi...</div>
      
		<div class="menu-wrapper">
			<button id="menuBtn">‚ãÆ</button>
			<div id="menuDropdown" class="menu-dropdown">
				<div class="menu-item" id="reportBtn">üö´ B√°o c√°o</div>
				<div class="menu-item" id="disconnectBtn">üö™ Tho√°t</div>
			</div>
		</div>
    </div>
    <div id="messages"></div>
		<div id="inputArea">
			<input id="msgInput" placeholder="Nh·∫≠p tin nh·∫Øn..." />
			<button id="sendBtn">G·ª≠i</button>
		</div>
  </div>
</div>

<script>
  let ws;
  let currentRoomId = null;

  const status = document.getElementById("status");
  const formSection = document.getElementById("formSection");
  const chatBox = document.getElementById("chatWrapper");
  const messages = document.getElementById("messages");
  const statusConnect = document.getElementById("statusConnect");
  const menuBtn = document.getElementById("menuBtn");
  const menuDropdown = document.getElementById("menuDropdown");
  
	menuBtn.onclick = () => {
	  menuDropdown.style.display = menuDropdown.style.display === "block" ? "none" : "block";
	};

	// B·∫•m ngo√†i ƒë·ªÉ ƒë√≥ng menu
	window.addEventListener("click", function(e) {
	  if (!menuBtn.contains(e.target) && !menuDropdown.contains(e.target)) {
		menuDropdown.style.display = "none";
	  }
	});

	// X·ª≠ l√Ω b√°o c√°o
	document.getElementById("reportBtn").onclick = () => {
	  if (ws) {
		ws.send(JSON.stringify({
		  event: "report",
		  roomId: currentRoomId,
		  message: "T√¥i mu·ªën b√°o c√°o ng∆∞·ªùi n√†y"
		}));
	  }
	  alert("ƒê√£ b√°o c√°o ng∆∞·ªùi n√†y v√† tho√°t cu·ªôc tr√≤ chuy·ªán.");
	  resetUI();
	  status.textContent = "ƒê√£ b√°o c√°o v√† tho√°t";
	  ws.close();
	};

  document.getElementById("connectBtn").onclick = () => {
    const name = document.getElementById("name").value.trim();
    const age = document.getElementById("age").value.trim();
    const gender = document.getElementById("gender").value;
	const vitri = document.getElementById("vitri").value;
    const lookingFor = document.getElementById("lookingFor").value;

    if (!name || !age || !gender || !lookingFor|| !vitri) {
      alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin");
      return;
    }

    const url = `${location.origin.replace(/^http/, 'ws')}/chat?name=${encodeURIComponent(name)}&age=${age}&gender=${gender}&vitri=${vitri}&lookingFor=${lookingFor}`;
    ws = new WebSocket(url);
	console.log("url:",url)
	
    ws.onopen = () => {
      status.textContent = "ƒêang t√¨m b·∫°n chat...";
	  statusConnect.textContent = "ƒêang t√¨m b·∫°n chat...";
    };

    ws.onmessage = (event) => {
		const data = JSON.parse(event.data);

		if (data.event === "matched") {
			currentRoomId = data.roomId;
			status.textContent = `ƒê√£ gh√©p n·ªëi v·ªõi ${data.partner.name}`;
			formSection.style.display = "none";
			chatBox.style.display = "flex";
		}

		if (data.event === "chat") {
			appendMessage(`${data.message}`, "partner");
		}
	  
		if (data.event === "partner_left") {
			console.log("Ng∆∞·ªùi kia ƒë√£ r·ªùi kh·ªèi cu·ªôc tr√≤ chuy·ªán.");
			alert("Ng∆∞·ªùi kia ƒë√£ r·ªùi kh·ªèi cu·ªôc tr√≤ chuy·ªán.");
			resetUI();
			return;
		}
	  
    };

    ws.onclose = () => {
		resetUI();
      resetUI();
    };

    ws.onerror = () => {
      status.textContent = "L·ªói k·∫øt n·ªëi";
    };
  };

  document.getElementById("sendBtn").onclick = () => {
    const input = document.getElementById("msgInput");
    const msg = input.value.trim();
    if (msg && ws && ws.readyState === WebSocket.OPEN) {
      ws.send(JSON.stringify({
        event: "chat",
        roomId: currentRoomId,
        message: msg
      }));
      appendMessage(`${msg}`, "me");
      input.value = "";
    }
  };

  document.getElementById("msgInput").addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      document.getElementById("sendBtn").click();
    }
  });

  document.getElementById("disconnectBtn").onclick = () => {
    if (ws) {
		ws.send(JSON.stringify({
			event: "partner_left",
			roomId: currentRoomId,
			message: "Ng∆∞·ªùi kia ƒë√£ tho√°t kh·ªèi cu·ªôc tr√≤ chuy·ªán"
      }));
    }
    resetUI();
    status.textContent = "ƒê√£ tho√°t kh·ªèi cu·ªôc tr√≤ chuy·ªán";
	ws.close();
  };
  
	window.addEventListener("resize", () => {
		scrollToBottom();
	});

	function appendMessage(text, cls) {
		const div = document.createElement("div");
		div.textContent = text;
		div.className = cls;
		messages.appendChild(div);

		// ƒê·∫£m b·∫£o n·ªôi dung ƒë∆∞·ª£c render tr∆∞·ªõc khi cu·ªôn
		requestAnimationFrame(() => {
		messages.scrollTop = messages.scrollHeight;
		});
	}
	
	function scrollToBottom() {
		requestAnimationFrame(() => {
			messages.scrollTop = messages.scrollHeight;
		});
	}

  function resetUI() {
    formSection.style.display = "flex";
	statusConnect.textContent = ""
    chatBox.style.display = "none";
    messages.innerHTML = "";
    document.getElementById("msgInput").value = "";
    currentRoomId = null;
  }
  
  
  
  // =============================================================================================
	function isFromApp() {
		return navigator.userAgent.includes("MyChatAppWebView/1.0");
	}

	function isMobileBrowser() {
		return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent) && !isFromApp();
	}
	
	function createGoogleAdTrochoitinhnhanh(position) {
		const container = document.createElement('div');
		container.className = `google-like-ad google-like-ad-${position}`;
		container.style.position = 'fixed';

		container.innerHTML = `
		<img class="ad-img" src="https://hngame.store/image/trochoitinhnhanh.png" />
		<div class="ad-content">
		<div class="ad-title">Tr√≤ ch∆°i t√≠nh nhanh - Game th·ª≠ th√°ch t√†i t√≠nh nhanh c·ªßa b·∫°n!</div>
		<div class="ad-desc">Tham gia th·ª≠ th√°ch ngay h√¥m nay!</div>
		</div>
		<a class="ad-action" href="https://play.google.com/store/apps/details?id=com.hngame.trochoitinhnhanh" target="_blank">T·∫£i ngay</a>
		<div class="ad-close" onclick="this.parentElement.remove()">√ó</div>
		`;
		document.body.appendChild(container);
	}
	
	function createGoogleAdChatTimbanananh(position) {
		const container = document.createElement('div');
		container.className = `google-like-ad google-like-ad-${position}`;
		container.style.position = 'fixed';

		container.innerHTML = `
		<img class="ad-img" src="https://hngame.store/image/chattimban.png" />
		<div class="ad-content">
		<div class="ad-title">Chat T√¨m B·∫°n ·∫®n Danh Quanh B·∫°n - Tr√≤ chuy·ªán ri√™ng t∆∞, l√†m quen k·∫øt b·∫°n, ki·∫øm ng∆∞·ªùi y√™u!</div>
		<div class="ad-desc">Tham gia v√†o nh·ªØng cu·ªôc tr√≤ chuy·ªán vui v·∫ª ngay h√¥m nay!</div>
		</div>
		<a class="ad-action" href="https://play.google.com/store/apps/details?id=com.hngame.timbanquanhday" target="_blank">T·∫£i ngay</a>
		<div class="ad-close" onclick="this.parentElement.remove()">√ó</div>
		`;
		document.body.appendChild(container);
	}

	// B·ªè ƒëi·ªÅu ki·ªán, lu√¥n hi·ªÉn th·ªã 2 banner
	if (!isFromApp()) {
		createGoogleAdTrochoitinhnhanh("top");
		createGoogleAdChatTimbanananh("bottom");
	}
	
	function showSideBanners() {
    if (!document.getElementById('side-banner-style')) {
      const style = document.createElement('style');
      style.id = 'side-banner-style';
      style.innerHTML = `
		.side-banner {
			position: fixed;
			width: 200px;
			top: 50%;
			transform: translateY(-50%);
			cursor: pointer;
			z-index: 9999;
			box-shadow: 0 0 8px rgba(0,0,0,0.3);
			border-radius: 8px;
			overflow: hidden;
			background-color: white;
			padding-bottom: 10px;
		}
		.side-banner.left {
			left: 0;
			margin-left: 10px;
		}
		.side-banner.right {
			right: 0;
			margin-right: 10px;
		}
		.side-banner img {
			width: 100%;
			height: auto;
			object-fit: cover;
			display: block;
		}
		`;

      document.head.appendChild(style);
    }

    const bannerLeft = document.createElement('div');
    bannerLeft.className = 'side-banner left';
    bannerLeft.onclick = () => {
      window.open('https://play.google.com/store/apps/details?id=com.hngame.fishhero', '_blank');
    };
    const imgLeft = document.createElement('img');
    imgLeft.src = 'https://hngame.store/image/caancacabavuong.png';
    imgLeft.alt = 'Banner Tr√°i';
    bannerLeft.appendChild(imgLeft);
	const label = document.createElement('div');
	label.textContent = 'C√° ƒÇn C√° |	T·∫£i: Mi·ªÖn ph√≠.';
	label.style.textAlign = 'center';
	label.style.fontSize = '16px';
	label.style.fontWeight = 'bold';
	label.style.marginTop = '8px';
	label.style.color = '#000'; // m√†u ch·ªØ
	bannerLeft.appendChild(label);

    const bannerRight = document.createElement('div');
    bannerRight.className = 'side-banner right';
    bannerRight.onclick = () => {
      window.open('https://play.google.com/store/apps/details?id=com.hngame.fishhero', '_blank');
    };
    const imgRight = document.createElement('img');
    imgRight.src = 'https://hngame.store/image/caancacabavuong.png';
    imgRight.alt = 'Banner Ph·∫£i';
    bannerRight.appendChild(imgRight);
	bannerRight.appendChild(label);

    document.body.appendChild(bannerRight);
	}

  // G·ªçi h√†m hi·ªÉn th·ªã banner khi trang load xong
	window.addEventListener('load', () => {
		if (!isFromApp() && !isMobileBrowser()) {
			showSideBanners();
		}
	});
	
  
</script>

</body>
</html>